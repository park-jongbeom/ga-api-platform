{
  "dashboard": {
    "title": "AI 상담 서비스 모니터링",
    "tags": ["ai", "consultant", "rag", "llm"],
    "timezone": "Asia/Seoul",
    "refresh": "10s",
    "panels": [
      {
        "id": 1,
        "title": "AI 상담 요청 처리량",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(consultant_chat_requests_total[5m])",
            "legendFormat": "요청/초"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0}
      },
      {
        "id": 2,
        "title": "응답 시간 (95 percentile)",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(consultant_chat_processing_seconds_bucket[5m]))",
            "legendFormat": "p95"
          },
          {
            "expr": "histogram_quantile(0.50, rate(consultant_chat_processing_seconds_bucket[5m]))",
            "legendFormat": "p50"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "yaxes": [
          {"format": "s", "label": "시간"}
        ]
      },
      {
        "id": 3,
        "title": "오류율",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(consultant_chat_errors_total[5m])",
            "legendFormat": "오류/초"
          }
        ],
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 8},
        "alert": {
          "conditions": [
            {
              "evaluator": {"params": [0.05], "type": "gt"},
              "query": {"params": ["A", "5m", "now"]},
              "type": "query"
            }
          ]
        }
      },
      {
        "id": 4,
        "title": "RAG 검색 성능",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(rag_search_duration_seconds_bucket[5m]))",
            "legendFormat": "검색 시간 (p95)"
          },
          {
            "expr": "avg(rag_search_documents_found)",
            "legendFormat": "평균 검색 문서 수"
          }
        ],
        "gridPos": {"h": 8, "w": 8, "x": 8, "y": 8}
      },
      {
        "id": 5,
        "title": "프롬프트 인젝션 차단 건수",
        "type": "stat",
        "targets": [
          {
            "expr": "increase(prompt_injection_blocked_total[1h])",
            "legendFormat": "지난 1시간"
          }
        ],
        "gridPos": {"h": 8, "w": 8, "x": 16, "y": 8}
      },
      {
        "id": 6,
        "title": "JVM 힙 메모리 사용률",
        "type": "graph",
        "targets": [
          {
            "expr": "jvm_memory_used_bytes{area='heap'} / jvm_memory_max_bytes{area='heap'}",
            "legendFormat": "힙 사용률"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "yaxes": [
          {"format": "percentunit", "max": 1}
        ]
      },
      {
        "id": 7,
        "title": "DB 연결 풀 상태",
        "type": "graph",
        "targets": [
          {
            "expr": "hikaricp_connections_active",
            "legendFormat": "활성 연결"
          },
          {
            "expr": "hikaricp_connections_idle",
            "legendFormat": "유휴 연결"
          },
          {
            "expr": "hikaricp_connections_max",
            "legendFormat": "최대 연결"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}
      },
      {
        "id": 8,
        "title": "LLM API 호출 통계",
        "type": "table",
        "targets": [
          {
            "expr": "sum by (status) (increase(llm_api_calls_total[1h]))",
            "format": "table",
            "instant": true
          }
        ],
        "gridPos": {"h": 8, "w": 8, "x": 0, "y": 24}
      },
      {
        "id": 9,
        "title": "보안 이벤트 타임라인",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(prompt_injection_blocked_total[5m])",
            "legendFormat": "프롬프트 인젝션"
          },
          {
            "expr": "rate(xss_blocked_total[5m])",
            "legendFormat": "XSS 차단"
          },
          {
            "expr": "rate(sql_injection_blocked_total[5m])",
            "legendFormat": "SQL Injection"
          }
        ],
        "gridPos": {"h": 8, "w": 16, "x": 8, "y": 24}
      },
      {
        "id": 10,
        "title": "테넌트별 요청 분포",
        "type": "piechart",
        "targets": [
          {
            "expr": "sum by (tenant_id) (increase(consultant_chat_requests_total[1h]))"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32}
      },
      {
        "id": 11,
        "title": "문서 타입별 검색 빈도",
        "type": "bar",
        "targets": [
          {
            "expr": "sum by (document_type) (increase(rag_search_by_type_total[1h]))"
          }
        ],
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32}
      }
    ]
  }
}
